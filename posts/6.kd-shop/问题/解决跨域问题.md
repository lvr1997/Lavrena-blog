问题发生在在测试科大商铺首页分类数据接口时候，前端调用后端的请求分类数据的api发生了跨域问题，报错如下：

![](https://gitee.com/lvr1997/PicGioRepository/raw/master/img/F15A8A242BA8856B126AC2D5B815D03E.JPG)

因为项目还整合了shiro、jwt，所以经过一番排查，发现是在过滤器配置请求头信息时少配置了Access-Control-Allow-Credentials这一项

在过滤器配置类上加上httpServletResponse.setHeader("Access-Control-Allow-Credentials", "true");解决

那么为什么要配置Access-Control-Allow-Credentials这个请求头信息呢？

> Access-Control-Allow-Credentials
> 该字段可选。它的值是一个布尔值，表示是否允许发送Cookie.默认情况下，不发生Cookie，即：false。对服务器有特殊要求的请求，比如请求方法是PUT或DELETE，或者Content-Type字段的类型是application/json，这个值只能设为true。如果服务器不要浏览器发送Cookie，删除该字段即可

**完整的跨域方案如下：**

1. 配置拦截器

```java
// com.lvr.kdshop.config.CorsConfig

@Configuration
public class CorsConfig implements WebMvcConfigurer {
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedOrigins("*")
                .allowedMethods("GET", "HEAD", "POST", "PUT", "DELETE", "OPTIONS")
                .allowCredentials(true)
                .maxAge(3600)
                .allowedHeaders("*");
    }
}
```

2. 配置过滤器

```java
// com.lvr.kdshop.shiro.JwtFilter

@Component
public class JwtFilter  extends AuthenticatingFilter {
    /**
      * 对跨域提供支持
      */
    @Override
    protected boolean preHandle(ServletRequest request, ServletResponse response) throws Exception {
        HttpServletRequest httpServletRequest = WebUtils.toHttp(request);
        HttpServletResponse httpServletResponse = WebUtils.toHttp(response);
        httpServletResponse.setHeader("Access-control-Allow-Origin", httpServletRequest.getHeader("Origin"));
        httpServletResponse.setHeader("Access-Control-Allow-Methods", "GET,POST,OPTIONS,PUT,DELETE");
        httpServletResponse.setHeader("Access-Control-Allow-Headers", httpServletRequest.getHeader("Access-Control-Request-Headers"));
        httpServletResponse.setHeader("Access-Control-Allow-Credentials", "true");
        // 跨域时会首先发送一个OPTIONS请求，这里我们给OPTIONS请求直接返回正常状态
        if (httpServletRequest.getMethod().equals(RequestMethod.OPTIONS.name())) {
            httpServletResponse.setStatus(HttpStatus.OK.value());
            return false;
        }
        return super.preHandle(request, response);
    }
}
```